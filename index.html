<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; base-uri 'self'; object-src 'none'; frame-ancestors 'none'; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.jsdelivr.net; img-src 'self' data: blob:; font-src 'self' https://fonts.gstatic.com; connect-src 'self' https://azure.s53m.com https://sm7iun.se https://www.google-analytics.com https://region1.google-analytics.com;"
    />
    <meta name="referrer" content="strict-origin-when-cross-origin" />
    <title>RBN Signal Analysis</title>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-5GZP4X3VVH"
      crossorigin="anonymous"
      referrerpolicy="strict-origin-when-cross-origin"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-5GZP4X3VVH");
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600;700&family=Space+Grotesk:wght@500;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
      crossorigin="anonymous"
      referrerpolicy="strict-origin-when-cross-origin"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="bg-grid" aria-hidden="true"></div>
    <main class="app-shell">
      <header class="hero">
        <div class="hero-main">
          <div class="hero-title-wrap">
            <div>
              <p class="kicker">RBN Analysis Tool</p>
              <h1>RBN Signal Comparative Analysis</h1>
            </div>
            <div class="chapter-tabs" role="tablist" aria-label="Analysis chapters">
              <button
                id="tab-historical"
                class="chapter-tab is-active"
                role="tab"
                type="button"
                aria-controls="chapter-historical"
                aria-selected="true"
                data-chapter-tab="historical"
              >
                Historical analysis
              </button>
              <button
                id="tab-live"
                class="chapter-tab"
                role="tab"
                type="button"
                aria-controls="chapter-live"
                aria-selected="false"
                data-chapter-tab="live"
              >
                Live analysis
              </button>
              <button
                id="tab-skimmer"
                class="chapter-tab"
                role="tab"
                type="button"
                aria-controls="chapter-skimmer"
                aria-selected="false"
                data-chapter-tab="skimmer"
              >
                Skimmer comparison
              </button>
            </div>
          </div>
          <aside class="hero-status" aria-live="polite">
            <div id="status-pill" class="status-pill" data-state="ready">Ready</div>
            <p id="status-message" class="status-message" hidden></p>
            <div class="hero-checks" aria-label="Data loading progress">
              <span id="check-fetch" class="hero-check" data-state="pending"
                ><span class="hero-check-mark" aria-hidden="true">○</span>RBN data</span
              >
              <span id="check-cty" class="hero-check" data-state="pending"
                ><span class="hero-check-mark" aria-hidden="true">○</span>cty.dat</span
              >
              <span id="check-charts" class="hero-check" data-state="pending"
                ><span class="hero-check-mark" aria-hidden="true">○</span>Charts</span
              >
            </div>
          </aside>
        </div>
      </header>

      <section id="chapter-historical" class="chapter-pane chapter-pane-historical" role="tabpanel" aria-labelledby="tab-historical">
        <section class="panel input-panel" aria-labelledby="analysis-setup-heading">
          <div class="panel-head">
            <h2 id="analysis-setup-heading">Setup</h2>
          </div>

          <form id="analysis-form" novalidate>
            <div class="field-grid setup-row">
              <div class="field field-date">
                <label for="date-primary">Date 1 (UTC DD-MM-YYYY) <span class="req">*</span></label>
                <input
                  id="date-primary"
                  name="datePrimary"
                  type="text"
                  inputmode="numeric"
                  autocomplete="off"
                  placeholder="DD-MM-YYYY"
                  required
                />
              </div>
              <div class="field field-date">
                <label for="date-secondary">Date 2 (UTC DD-MM-YYYY)</label>
                <input
                  id="date-secondary"
                  name="dateSecondary"
                  type="text"
                  inputmode="numeric"
                  autocomplete="off"
                  placeholder="DD-MM-YYYY"
                />
              </div>
              <div class="field">
                <label for="call-primary">Primary callsign <span class="req">*</span></label>
                <input
                  id="call-primary"
                  name="callPrimary"
                  type="text"
                  maxlength="20"
                  inputmode="text"
                  autocomplete="off"
                  placeholder="S53ZO"
                  required
                />
              </div>
              <div class="field">
                <label for="call-compare-1">Compare callsign 1</label>
                <input
                  id="call-compare-1"
                  name="callCompare1"
                  type="text"
                  maxlength="20"
                  inputmode="text"
                  autocomplete="off"
                  placeholder="K1ABC"
                />
              </div>
              <div class="field">
                <label for="call-compare-2">Compare callsign 2</label>
                <input
                  id="call-compare-2"
                  name="callCompare2"
                  type="text"
                  maxlength="20"
                  inputmode="text"
                  autocomplete="off"
                  placeholder="DL1XYZ"
                />
              </div>
              <div class="field">
                <label for="call-compare-3">Compare callsign 3</label>
                <input
                  id="call-compare-3"
                  name="callCompare3"
                  type="text"
                  maxlength="20"
                  inputmode="text"
                  autocomplete="off"
                  placeholder="JA1AAA"
                />
              </div>
              <div class="field field-actions">
                <label for="start-analysis">Run</label>
                <div class="actions-row">
                  <button id="start-analysis" class="btn-primary" type="submit" disabled>Start analysis</button>
                  <button id="reset-analysis" class="btn-ghost" type="reset">Reset</button>
                  <button id="copy-permalink-historical" class="btn-ghost" type="button" hidden>Copy permalink</button>
                </div>
              </div>
            </div>
          </form>
        </section>

        <section class="panel charts-panel" aria-labelledby="charts-heading">
          <div class="panel-head">
            <h2 id="charts-heading">Signal Charts</h2>
            <p id="charts-note" class="panel-note">Charts appear after analysis starts.</p>
          </div>
          <div id="charts-root" class="charts-root empty-state">
            <p>No analysis results yet.</p>
          </div>
        </section>
      </section>

      <section
        id="chapter-live"
        class="chapter-pane chapter-pane-live"
        role="tabpanel"
        aria-labelledby="tab-live"
        hidden
      >
        <section class="panel input-panel" aria-labelledby="live-setup-heading">
          <div class="panel-head">
            <h2 id="live-setup-heading">Live Setup - will update every 5 minutes</h2>
          </div>
          <form id="live-analysis-form" novalidate>
            <div class="field-grid setup-row">
              <div class="field">
                <label for="live-window">Window (UTC)</label>
                <select id="live-window" name="liveWindow" class="live-window-select">
                  <option value="1">Last 1h</option>
                  <option value="6">Last 6h</option>
                  <option value="12">Last 12h</option>
                  <option value="24" selected>Last 24h</option>
                  <option value="48">Last 48h</option>
                </select>
              </div>
              <div class="field">
                <label for="live-call-primary">Primary callsign <span class="req">*</span></label>
                <input
                  id="live-call-primary"
                  name="liveCallPrimary"
                  type="text"
                  maxlength="20"
                  inputmode="text"
                  autocomplete="off"
                  placeholder="S53ZO"
                  required
                />
              </div>
              <div class="field">
                <label for="live-call-compare-1">Compare callsign 1</label>
                <input
                  id="live-call-compare-1"
                  name="liveCallCompare1"
                  type="text"
                  maxlength="20"
                  inputmode="text"
                  autocomplete="off"
                  placeholder="K1ABC"
                />
              </div>
              <div class="field">
                <label for="live-call-compare-2">Compare callsign 2</label>
                <input
                  id="live-call-compare-2"
                  name="liveCallCompare2"
                  type="text"
                  maxlength="20"
                  inputmode="text"
                  autocomplete="off"
                  placeholder="DL1XYZ"
                />
              </div>
              <div class="field">
                <label for="live-call-compare-3">Compare callsign 3</label>
                <input
                  id="live-call-compare-3"
                  name="liveCallCompare3"
                  type="text"
                  maxlength="20"
                  inputmode="text"
                  autocomplete="off"
                  placeholder="JA1AAA"
                />
              </div>
              <div class="field field-actions">
                <label for="start-live-analysis">Run</label>
                <div class="actions-row">
                  <button id="start-live-analysis" class="btn-primary" type="submit" disabled>Start live analysis</button>
                  <button id="reset-live-analysis" class="btn-ghost" type="reset">Reset</button>
                  <button id="copy-permalink-live" class="btn-ghost" type="button" hidden>Copy permalink</button>
                </div>
              </div>
            </div>
          </form>
          <div class="live-status-shell" aria-live="polite">
            <div id="live-status-pill" class="status-pill" data-state="ready">Ready</div>
            <p id="live-status-message" class="status-message" hidden></p>
          </div>
        </section>

        <section class="panel charts-panel" aria-labelledby="live-charts-heading">
          <div class="panel-head">
            <h2 id="live-charts-heading">Live Signal Charts</h2>
            <p id="live-charts-note" class="panel-note">Live charts appear after analysis starts.</p>
          </div>
          <div id="live-charts-root" class="charts-root empty-state">
            <p>No live analysis results yet.</p>
          </div>
        </section>
      </section>

      <section
        id="chapter-skimmer"
        class="chapter-pane chapter-pane-skimmer"
        role="tabpanel"
        aria-labelledby="tab-skimmer"
        hidden
      >
        <section class="panel input-panel" aria-labelledby="skimmer-setup-heading">
          <div class="panel-head">
            <h2 id="skimmer-setup-heading">Skimmer Setup</h2>
            <p class="panel-note">How well do different skimmers receive a certain station?</p>
            <p class="panel-note">Guided flow for DXers and contesters. Fill top to bottom.</p>
          </div>
          <form id="skimmer-analysis-form" novalidate>
            <div id="skimmer-validation-summary" class="skimmer-validation-summary" hidden tabindex="-1">
              <p>Fix the following before running:</p>
              <ul id="skimmer-validation-list"></ul>
            </div>

            <section class="skimmer-step" aria-labelledby="skimmer-step-calls">
              <h3 id="skimmer-step-calls"><span>Step 1</span> Callsigns</h3>
              <p class="skimmer-step-note">Primary is required. Add up to 3 comparison callsigns.</p>
              <div class="field-grid setup-row">
                <div class="field">
                  <label for="skimmer-call-primary">Skimmer callsign 1 <span class="req">*</span></label>
                  <input
                    id="skimmer-call-primary"
                    name="skimmerCallPrimary"
                    type="text"
                    list="skimmer-callsign-list"
                    maxlength="20"
                    inputmode="text"
                    autocomplete="off"
                    placeholder="S53ZO"
                    required
                  />
                  <p id="skimmer-help-call-primary" class="field-help"></p>
                  <p id="skimmer-error-call-primary" class="field-error" hidden></p>
                </div>
                <div class="field">
                  <label for="skimmer-call-compare-1">Skimmer callsign 2</label>
                  <input
                    id="skimmer-call-compare-1"
                    name="skimmerCallCompare1"
                    type="text"
                    list="skimmer-callsign-list"
                    maxlength="20"
                    inputmode="text"
                    autocomplete="off"
                    placeholder="K1ABC"
                  />
                  <p id="skimmer-help-call-compare-1" class="field-help"></p>
                  <p id="skimmer-error-call-compare-1" class="field-error" hidden></p>
                </div>
                <div class="field">
                  <label for="skimmer-call-compare-2">Skimmer callsign 3</label>
                  <input
                    id="skimmer-call-compare-2"
                    name="skimmerCallCompare2"
                    type="text"
                    list="skimmer-callsign-list"
                    maxlength="20"
                    inputmode="text"
                    autocomplete="off"
                    placeholder="DL1XYZ"
                  />
                  <p id="skimmer-help-call-compare-2" class="field-help"></p>
                  <p id="skimmer-error-call-compare-2" class="field-error" hidden></p>
                </div>
                <div class="field">
                  <label for="skimmer-call-compare-3">Skimmer callsign 4</label>
                  <input
                    id="skimmer-call-compare-3"
                    name="skimmerCallCompare3"
                    type="text"
                    list="skimmer-callsign-list"
                    maxlength="20"
                    inputmode="text"
                    autocomplete="off"
                    placeholder="JA1AAA"
                  />
                  <p id="skimmer-help-call-compare-3" class="field-help"></p>
                  <p id="skimmer-error-call-compare-3" class="field-error" hidden></p>
                </div>
              </div>
              <div id="skimmer-peer-suggestions" class="skimmer-peer-suggestions" hidden>
                <p id="skimmer-peer-suggestions-meta" class="field-help"></p>
                <div id="skimmer-peer-suggestions-list" class="skimmer-peer-suggestions-list"></div>
              </div>
              <datalist id="skimmer-callsign-list"></datalist>
            </section>

            <section class="skimmer-step" aria-labelledby="skimmer-step-time">
              <h3 id="skimmer-step-time"><span>Step 2</span> UTC Time Window</h3>
              <p class="skimmer-step-note"></p>
              <div class="skimmer-quick-range" role="group" aria-label="Quick UTC ranges">
                <button type="button" class="btn-chip" data-skimmer-hours="1">Last 1h</button>
                <button type="button" class="btn-chip" data-skimmer-hours="6">Last 6h</button>
                <button type="button" class="btn-chip" data-skimmer-hours="12">Last 12h</button>
                <button type="button" class="btn-chip" data-skimmer-hours="24">Last 24h</button>
                <button type="button" class="btn-chip" data-skimmer-hours="48">Last 48h</button>
              </div>
              <div class="field-grid setup-row">
                <div class="field field-datetime">
                  <label for="skimmer-from">UTC from (DD-MM-YYYY HH:MM) <span class="req">*</span></label>
                  <input
                    id="skimmer-from"
                    name="skimmerFrom"
                    type="text"
                    inputmode="numeric"
                    autocomplete="off"
                    placeholder="DD-MM-YYYY HH:MM"
                    required
                  />
                  <p id="skimmer-help-from" class="field-help">Start of analysis window in UTC.</p>
                  <p id="skimmer-error-from" class="field-error" hidden></p>
                </div>
                <div class="field field-datetime">
                  <label for="skimmer-to">UTC to (DD-MM-YYYY HH:MM) <span class="req">*</span></label>
                  <input
                    id="skimmer-to"
                    name="skimmerTo"
                    type="text"
                    inputmode="numeric"
                    autocomplete="off"
                    placeholder="DD-MM-YYYY HH:MM"
                    required
                  />
                  <p id="skimmer-help-to" class="field-help">End of analysis window in UTC.</p>
                  <p id="skimmer-error-to" class="field-error" hidden></p>
                </div>
              </div>
            </section>

            <section class="skimmer-step" aria-labelledby="skimmer-step-scope">
              <h3 id="skimmer-step-scope"><span>Step 3</span> Skimmer Scope</h3>
              <p class="skimmer-step-note">Global is default. For targeted analysis, most users choose DXCC. - for example put S5 as DXCC to compare how skimmers from above receive S5 stations. Global means compare the whole world</p>
              <div class="field-grid setup-row">
                <div class="field">
                  <label for="skimmer-area-type">Skimmer scope type</label>
                  <select id="skimmer-area-type" name="skimmerAreaType" class="live-window-select">
                    <option value="GLOBAL" selected>Global</option>
                    <option value="DXCC">DXCC (recommended for targeted checks)</option>
                    <option value="CALLSIGN">Callsign (single station)</option>
                    <option value="CONTINENT">Continent</option>
                    <option value="CQ">CQ zone</option>
                    <option value="ITU">ITU zone</option>
                  </select>
                  <p id="skimmer-help-area-type" class="field-help">Choose how to filter skimmer stations.</p>
                  <p id="skimmer-error-area-type" class="field-error" hidden></p>
                </div>
                <div class="field">
                  <label for="skimmer-area-value">Scope value</label>
                  <input
                    id="skimmer-area-value"
                    name="skimmerAreaValue"
                    type="text"
                    inputmode="text"
                    autocomplete="off"
                    placeholder="Not required for Global"
                  />
                  <p id="skimmer-help-area-value" class="field-help">DXCC examples: JA, DL, W, or country name.</p>
                  <p id="skimmer-error-area-value" class="field-error" hidden></p>
                </div>
              </div>
            </section>

            <section class="skimmer-step skimmer-step-run" aria-labelledby="skimmer-step-run">
              <h3 id="skimmer-step-run"><span>Step 4</span> Run</h3>
              <p class="skimmer-step-note">When fields are valid, start skimmer comparison.</p>
              <div class="actions-row">
                <button id="start-skimmer-analysis" class="btn-primary" type="submit" disabled>Start skimmer analysis</button>
                <button id="reset-skimmer-analysis" class="btn-ghost" type="reset">Reset</button>
                <button id="copy-permalink-skimmer" class="btn-ghost" type="button" hidden>Copy permalink</button>
              </div>
            </section>
          </form>
          <div class="live-status-shell" aria-live="polite">
            <div id="skimmer-status-pill" class="status-pill" data-state="ready">Ready</div>
            <p id="skimmer-status-message" class="status-message" hidden></p>
            <div class="hero-checks" aria-label="Skimmer data loading progress">
              <span id="skimmer-check-fetch" class="hero-check" data-state="pending"
                ><span class="hero-check-mark" aria-hidden="true">○</span>RBN data</span
              >
              <span id="skimmer-check-cty" class="hero-check" data-state="pending"
                ><span class="hero-check-mark" aria-hidden="true">○</span>cty.dat</span
              >
              <span id="skimmer-check-charts" class="hero-check" data-state="pending"
                ><span class="hero-check-mark" aria-hidden="true">○</span>SM7UIN stats</span
              >
            </div>
          </div>
        </section>

        <section class="panel charts-panel" aria-labelledby="skimmer-charts-heading">
          <div class="panel-head">
            <h2 id="skimmer-charts-heading">Skimmer Signal Charts</h2>
            <p id="skimmer-charts-note" class="panel-note">Skimmer comparison charts appear after analysis starts.</p>
          </div>
          <div id="skimmer-charts-root" class="charts-root empty-state">
            <p>No skimmer comparison results yet.</p>
          </div>
        </section>
      </section>
    </main>

    <script
      src="https://cdn.jsdelivr.net/npm/flatpickr"
      crossorigin="anonymous"
      referrerpolicy="strict-origin-when-cross-origin"
    ></script>
    <script type="module">
      import(`./app.mjs?v=${Date.now()}`);
    </script>
  </body>
</html>
